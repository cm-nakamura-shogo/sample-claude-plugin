$ARGUMENTS というpythonファイルをリファクタしましょう

まず、必ず最新のファイルを読み込んでから作業を行なってください。

以下のルールに従って順にリファクタリングを行います。

## 関数設計の修正

### 関数の粒度修正
- 単一責任の原則に従い、関数を分割してください。
- 目安として30行を超える関数は分割を検討してください。

### 関数の引数修正（データ構造の改善）
- 引数の数が多くバケツリレーが発生している場合、バラバラの値を渡すのではなく、**意味のある単位でまとめたデータクラス（dataclass/Pydantic等）**を作成し、それを渡すようにしてください。
- 文字列解析などのロジックは下位関数に持ち込まず、呼び出し元（または境界）で解析済みのオブジェクトに変換してから渡すことを優先してください。
- 複数の場所で共通して使用する環境設定などは、コンテキストオブジェクトにまとめて渡すことを検討してください。

### 例外と型の扱い
- `None` を許容しない引数は、型ヒントから `Optional` を外し、静的解析で担保してください。
- 実行時の値チェック（ガード節）は、外部入力の境界や、型システムで表現しきれないビジネスルールの検証に留めてください。
- 特別な対応が必要な場合は、隠しフラグではなく、明示的なパラメータや戦略オブジェクト（Strategy Pattern）を使用してください。

## 実装詳細の修正

### 変数のスコープと安全性
- 変数は可能な限り使用するスコープの近くで定義してください。
- ただし、条件分岐内で定義された変数が分岐外で参照される場合は、必ず分岐の前で初期化を行うか、すべての分岐で値が代入されることを保証してください。

### 関数呼び出し
- 自作関数の呼び出しには、可読性と安全性向上のため**キーワード引数**を使用してください。
- 可能であれば、関数定義側で `*` を使用し、キーワード引数を強制する形にリファクタリングしてください。

### 副作用の最小化
- 引数として渡された可変オブジェクト（List, Dict, DataFrame等）を関数内で直接書き換えないでください。
- 必ず新しいオブジェクトを作成して `return` で返却してください。
- **この原則を守ることで `return` が多すぎると感じたり、戻り値の扱いが複雑になった場合は、関数の責務が大きすぎるサインです。無理に実装せず、冒頭の関数設計（粒度の修正）に立ち返ってください。**

### コメント（日本語可）
- **コードの逐語訳（何をしているか）は書かないでください。**
- 代わりに、**処理の意図（なぜそうしているか）**や、**論理的なブロックごとの要約**を日本語で記述してください。
- docstringには関数の目的、引数、戻り値、送出する例外について記述してください（型情報は型ヒントに任せる）。
